# 业务拓扑页面
此页面为功能最复杂的页面，涉及到的逻辑比较多，操作之间也有相互影响，开发时需检查全面一点

## 拓扑树
拓扑树的默认层级为`业务-集群-模块-主机`，可以通过`模型-模型关系-编辑拓扑`添加自定义层级  
拓扑树须由前端调用两个接口将内置的空闲机池与其他的拓扑树进行组装，形成完整的拓扑树  
自定义层级节点可以直接创建，集群、模块节点有两种方式：  
- 集群：
  - 集群模板创建（创建后，集群模板中的模块节点会一并创建，且后续只能通过修改集群模板下的模块节点来变更拓扑树的节点）
  - 直接创建（不会创建模块节点）
- 模块：
  - 服务模板创建（通过模板创建的模块，主机移入后，会自动将模板中的进行信息初始化到主机上）
  - 直接创建（移入的主机没有进程信息，只有一个为空的服务实例）

## 主机列表
对主机的操作包含两部分，一部分是变更主机的模块，一部分是主机的导入导出

### 对主机模块的操作
- 新增(仅非空闲模块节点可用)： 通过主机选择器选择主机，将选择的追加到当前模块，此操作不会改变主机原有的模块，属于增量操作。如：主机原本属于A、B模块，新增主机到模块C后，主机便属于A、B、C三个模块
- 转移至
  - 空闲模块(空闲机、故障机、待回收)：此操作会删除主机原有的所有模块，转移后仅属于空闲模块。如主机从A模块转移到空闲机模块后，主机仅属于空闲机模块
  - 业务模块：此操作移除原有的模块，并添加新的模块信息，属于替换操作。如主机属于A、B模块，转移至C、D模块后，主机仅属于C、D模块，如果主机前后模块有相同的，后端会忽略对应主机相同模块的变动
  - 主机池（仅空闲机模块可用）： 将空闲机模块中的主机上交至资源池，即从当前业务移除
  - 其他业务(仅空闲机模块可用)： 将空闲机模块中的主机转移到其他业务的空闲机模块下
- 追加至
  - 业务模块： 将选中的主机追加至其他模块(N个主机-M个模块)，跟上面的新增操作类似(N个主机-1个模块)，属于增量操作
- 移出
  - 当前模块（仅模块节点可用）：将当前模块选中的主机移出，保留主机的其他模块，如主机仅属于当前模块，移出后，主机会自动转移至空闲机

### 复制及导入导出
- 复制：复制选中主机指定的属性值，其中`云区域ID:IP`非原生数据，需要手动拼接
- 更多
   - 导出选中： 导出选中的主机，需进一步选择导出属性、关联关系
   - 导出全部: 以当前的查询条件，导出符合条件的所有主机，需进一步选择导出属性、关联关系
   - 导入excel更新：仅更新当前业务下的主机，无法更新非当前业务的主机，可以在导入任务中选择是否导入关联关系

### 筛选
有值的筛选项，均会以tag的形式展示在列表上方，点击tag可以对已有筛选项进行快速编辑，这部分筛选项对应的属性如果表格列中没有，会追加显示到表格列最后
- 快捷筛选： 仅IP及固资编号支持快捷筛选
- 收藏条件： 通过将高级筛选的条件进行收藏，可以在收藏列表中快速使用常用筛选条件
- 高级筛选： 可以选择主机、集群、模块三个模型的属性对主机进行筛选。高级筛选中选择的属性会通过用户习惯接口进行存储，下次进入时进行复原。如果没有进行过设置，将会展示默认的几个属性

## 服务实例
服务实例的展示有两种视角：
- 实例视角： 以主机为维度展示服务实例，展开后可以查看该主机服务实例的所有进程信息
- 进程视角： 以进程为维度聚合所有相同进程名的服务实例，展开后可以看到所有拥有该进程的服务实例

## 节点信息
除内置的空闲机池的信息需要额外处理，其他的均可通过对应的接口调用接口查询